<!DOCTYPE html>
<html lang="en">

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/p5.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/addons/p5.sound.min.js"></script>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
    }

    canvas {
      display: block;
    }
  </style>
  <meta charset="utf-8" />

</head>

<body>

  <script>
    class Particle {

      constructor(x, y, angle, magn) {

        this.pos = createVector(x * 0.001, y * 0.001);
        this.pos.setMag(1);
        let diff = (this.pos.heading() - Math.atan2(y, x));
        this.pos.rotate(diff);
        this.vel = this.pos.copy();
        this.vel.setMag(0.02 * magn);
        this.col = color(random(100, 255), 30, random(100, 255));
        this.maxy = random(70, 80);
      }

      update() {
        this.pos.add(this.vel);
      }

      offScreen() {
        return (abs(this.pos.y) > this.maxy || this.pos.y >= start);
      }

      show() {
        noFill();
        stroke(this.col);
        strokeWeight(3);
        point(this.pos.x, this.pos.y);
      }
    }
  </script>
  <script>
    // PROPOSED PI DAY (2020) CHALLENGE
    // PLEASE CHECK ( https://github.com/CodingTrain/Rainbow-Topics/issues/1467 ) FOR MORE ON THE CHALLENGE !!!

    let angle = 0;
    let heartPoints = [];
    let particles = [];
    let last_to_leave = null;
    let start;

    function setup() {
      let c = createCanvas(windowWidth, windowHeight);
      angle = 0;

    }

    function ConstructHeart(h, k) {
      let partOfParticles = [];
      let stch;
      if (random(1) > 0.5) {
        stch = 1;
      } else {
        stch = -1;
      }
      let center = createVector(h, k);
      partOfParticles.push(center);
      let index = 0;
      angle = 0;
      for (; angle <= (TWO_PI); angle += 0.08) {
        let r = map(pow(sin(angle), 1), -1, 1, 10, 10);
        let x = stch * (r * (16 * pow(sin(angle), 3)));
        let y = (r * (-1) * (13 * cos(angle) - 5 * cos(2 * angle) - 2 * cos(3 * angle) - cos(4 * angle)));
        let vect = createVector(x, y);
        let p = new Particle(x, y, angle, vect.mag())
        partOfParticles.push(p);
        if (index === 0) {
          last_to_leave = p;
          start = p.pos.y;
          index++;
        }

      }
      particles.push(partOfParticles);
      console.log(partOfParticles.length);
    }

    function mousePressed() {
      if (mouseButton === LEFT) {
        ConstructHeart(mouseX, mouseY);
        //print(mouseX,mouseY);
      } else {
        ConstructHeart(width / 2, height / 2);
      }
    }

    function draw() {
      background(0, 0, 0, 80);
      fill(200, 0, 150);
      // rect(0, 0, 300, 60, 0, 0, 25, 0);
      textSize(30);
      textFont('Georgia');
      fill(255);
      // text('Click to form Hearts', 15, 40);
      translate(width / 2, height / 2);

      noFill();
      for (let arrofpart of particles) {
        push();
        translate(arrofpart[0].x - width / 2, arrofpart[0].y - height / 2);
        for (let c of arrofpart.slice(1)) {
          c.show();
          c.update();
          //       if (arrofpart[1].offScreen()) {
          //         for (let d of arrofpart.slice(1)) {
          //           d.vel.mult(-1);

          //         }
          //       }
        }
        pop();
      }

      angle += 0.01;

    }
  </script>
</body>

</html>